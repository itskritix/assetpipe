---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Login">
  <section class="auth-page">
    <div class="auth-container">
      <div class="auth-branding">
        <div class="auth-branding__content">
          <div class="brand-logo-large">
            <span class="brand-letter">A</span>
            <span class="brand-letter brand-letter--accent">P</span>
          </div>
          <h1>ASSET<br/>PIPE</h1>
          <p>OPEN-SOURCE LOGO LIBRARY</p>
          <div class="auth-stats">
            <div class="auth-stat">
              <span class="auth-stat__number">10K+</span>
              <span class="auth-stat__label">LOGOS</span>
            </div>
            <div class="auth-stat">
              <span class="auth-stat__number">5K+</span>
              <span class="auth-stat__label">BRANDS</span>
            </div>
            <div class="auth-stat">
              <span class="auth-stat__number">FREE</span>
              <span class="auth-stat__label">FOREVER</span>
            </div>
          </div>
          <div class="auth-features">
            <div class="auth-feature">
              <span class="feature-icon">→</span>
              <span>SUBMIT LOGOS</span>
            </div>
            <div class="auth-feature">
              <span class="feature-icon">→</span>
              <span>TRACK SUBMISSIONS</span>
            </div>
            <div class="auth-feature">
              <span class="feature-icon">→</span>
              <span>API ACCESS</span>
            </div>
          </div>
        </div>
        <div class="auth-decoration"></div>
        <div class="auth-decoration auth-decoration--2"></div>
        <div class="auth-grid-bg"></div>
      </div>

      <div class="auth-form-container">
        <div class="auth-tabs">
          <button class="auth-tab auth-tab--active" data-tab="login">LOGIN</button>
          <button class="auth-tab" data-tab="signup">SIGN UP</button>
        </div>

        <form id="login-form" class="auth-form">
          <div class="form-field">
            <label for="login-email" class="label-brutal">EMAIL</label>
            <input type="email" id="login-email" name="email" required placeholder="YOUR@EMAIL.COM" class="input-brutal" />
          </div>

          <div class="form-field">
            <label for="login-password" class="label-brutal">PASSWORD</label>
            <input type="password" id="login-password" name="password" required placeholder="********" class="input-brutal" />
          </div>

          <div class="form-row">
            <label class="checkbox-brutal">
              <input type="checkbox" name="remember" />
              <span class="checkmark"></span>
              <span>REMEMBER ME</span>
            </label>
            <a href="/forgot-password" class="link-brutal">FORGOT PASSWORD?</a>
          </div>

          <button type="submit" class="btn-brutal btn-brutal--yellow auth-submit">LOGIN</button>
        </form>

        <form id="signup-form" class="auth-form hidden">
          <div class="form-field">
            <label for="signup-name" class="label-brutal">NAME</label>
            <input type="text" id="signup-name" name="name" required placeholder="YOUR NAME" class="input-brutal" />
          </div>

          <div class="form-field">
            <label for="signup-email" class="label-brutal">EMAIL</label>
            <input type="email" id="signup-email" name="email" required placeholder="YOUR@EMAIL.COM" class="input-brutal" />
          </div>

          <div class="form-field">
            <label for="signup-password" class="label-brutal">PASSWORD</label>
            <input type="password" id="signup-password" name="password" required placeholder="MIN 8 CHARACTERS" class="input-brutal" />
          </div>

          <div class="form-field">
            <label class="checkbox-brutal">
              <input type="checkbox" name="terms" required />
              <span class="checkmark"></span>
              <span>I AGREE TO THE <a href="/terms" class="link-brutal">TERMS</a></span>
            </label>
          </div>

          <button type="submit" class="btn-brutal btn-brutal--yellow auth-submit">CREATE ACCOUNT</button>
        </form>
      </div>
    </div>
  </section>
</Layout>

<script>
  const tabs = document.querySelectorAll('.auth-tab');
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('auth-tab--active'));
      tab.classList.add('auth-tab--active');
      if ((tab as HTMLElement).dataset.tab === 'login') {
        loginForm?.classList.remove('hidden');
        signupForm?.classList.add('hidden');
      } else {
        loginForm?.classList.add('hidden');
        signupForm?.classList.remove('hidden');
      }
    });
  });

  loginForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const submitBtn = loginForm.querySelector('.auth-submit') as HTMLButtonElement;
    submitBtn.disabled = true;
    submitBtn.textContent = 'LOGGING IN...';

    const email = (document.getElementById('login-email') as HTMLInputElement).value;
    const password = (document.getElementById('login-password') as HTMLInputElement).value;

    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ email, password }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Login failed');
      }

      window.location.href = '/dashboard';
    } catch (error) {
      window.toast.error(error instanceof Error ? error.message : 'LOGIN FAILED');
      submitBtn.disabled = false;
      submitBtn.textContent = 'LOGIN';
    }
  });

  signupForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const submitBtn = signupForm.querySelector('.auth-submit') as HTMLButtonElement;
    submitBtn.disabled = true;
    submitBtn.textContent = 'CREATING...';

    const name = (document.getElementById('signup-name') as HTMLInputElement).value;
    const email = (document.getElementById('signup-email') as HTMLInputElement).value;
    const password = (document.getElementById('signup-password') as HTMLInputElement).value;

    try {
      const response = await fetch('/api/auth/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ email, password, name }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Signup failed');
      }

      window.toast.success('CHECK YOUR EMAIL FOR CONFIRMATION LINK');
      submitBtn.disabled = false;
      submitBtn.textContent = 'CREATE ACCOUNT';
    } catch (error) {
      window.toast.error(error instanceof Error ? error.message : 'SIGNUP FAILED');
      submitBtn.disabled = false;
      submitBtn.textContent = 'CREATE ACCOUNT';
    }
  });
</script>
